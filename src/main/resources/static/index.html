<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React + Spring</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body id="root">
<script src="https://fb.me/react-15.0.1.js"></script>
<script src="https://fb.me/react-dom-15.0.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.css">

<script type="text/babel">
    //        import { Observable } from 'rxjs/Rx';
    //        import 'rxjs/operator/share';

    var ConsumerTable = React.createClass({
        render: function() {
            var rows = [];
            var tableStyle = {
                float: "left",
                textAlign: "center",
                width: "50%"
            };

            this.props.consumerApplications.forEach(function(consumerApplication) {
                rows.push(<ConsumerApplication consumerApplication={consumerApplication} />);
            });
            return (
                    <div className="container" name="ConsumerApplication" style={tableStyle}>
                        <h2>Consumer Accounts</h2>
                        <table className="table table-striped">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>FirstName</th>
                                <th>LastName</th>
                                <th>StoreNumber</th>
                                <th>Date</th>
                            </tr>
                            </thead>
                            <tbody>{rows}</tbody>
                        </table>
                    </div>);
        }
    });

    var CommercialTable = React.createClass({
        render: function() {
            var rows = [];
            var tableStyle = {
                float: "right",
                textAlign: "center",
                width: "50%"
            };

            this.props.commercialApplications.forEach(function(commercialApplication) {
                rows.push(<CommercialApplication commercialApplication={commercialApplication} />);
            });
            return (
                    <div className="container" name="CommercialApplication" style={tableStyle}>
                        <h2>Commercial Accounts</h2>
                        <table className="table table-striped">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>FirstName</th>
                                <th>LastName</th>
                                <th>StoreNumber</th>
                                <th>Date</th>
                            </tr>
                            </thead>
                            <tbody>{rows}</tbody>
                        </table>
                    </div>);
        }
    });

    var ConsumerApplication = React.createClass({
        getInitialState: function() {
            return {display: true };
        },
        handleDelete() {
            var self = this;
            $.ajax({
                url: self.props.consumerApplication._links.self.href,
                type: 'DELETE',
                success: function(result) {
                    self.setState({display: false});
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    toastr.error(xhr.responseJSON.message);
                }
            });
        },
        render: function() {
            if (this.state.display==false) return null;
            else return (
                    <tr>
                        <td>{this.props.consumerApplication.id}</td>
                        <td>{this.props.consumerApplication.firstName}</td>
                        <td>{this.props.consumerApplication.lastName}</td>
                        <td>{this.props.consumerApplication.strNumber}</td>
                        <td>{this.props.consumerApplication.date}</td>
                        <td>
                            <button className="btn btn-info" onClick={this.handleDelete}>Delete</button>
                        </td>
                    </tr>
            );
        }
    });

    var CommercialApplication = React.createClass({
        getInitialState: function() {
            return {display: true };
        },
        handleDelete() {
            var self = this;
            $.ajax({
                url: self.props.commercialApplication._links.self.href,
                type: 'DELETE',
                success: function(result) {
                    self.setState({display: false});
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    toastr.error(xhr.responseJSON.message);
                }
            });
        },
        render: function() {
            if (this.state.display==false) return null;
            else return (
                    <tr>
                        <td>{this.props.commercialApplication.id}</td>
                        <td>{this.props.commercialApplication.firstName}</td>
                        <td>{this.props.commercialApplication.lastName}</td>
                        <td>{this.props.commercialApplication.strNumber}</td>
                        <td>{this.props.commercialApplication.date}</td>
                        <td>
                            <button className="btn btn-info" onClick={this.handleDelete}>Delete</button>
                        </td>
                    </tr>
            );
        }
    });

    var App = React.createClass({

        loadConsumerApplicationsFromServer: function () {
            var self = this;
            $.ajax({
                url: "http://localhost:8080/api/consumerApplications"
            }).then(function (data) {
                self.setState({consumerApplications: data._embedded.consumerApplications});
            });
        },

        loadCommercialApplicationsFromServer: function () {
            var self = this;
            $.ajax({
                url: "http://localhost:8080/api/commercialApplications"
            }).then(function (data) {
                self.setState({commercialApplications: data._embedded.commercialApplications});
            });
        },

        getInitialState: function () {
            return {consumerApplications: [], commercialApplications: []};
        },

        componentDidMount: function () {
            this.loadConsumerApplicationsFromServer();
            this.loadCommercialApplicationsFromServer();
        },

        render() {
            var imageStyle = {
                float: "left"
            };
            var divHeaderStyle = {
                textAlign:"center"
            };
            var divBodyStyle = {
                clear:"left"
            };

            return (
                    <div>
                        <img src="images/Master_Depot_Logo.jpg" style={imageStyle}/>
                        <h1 style={divHeaderStyle}>Credit Services Center</h1>
                        <div style={divBodyStyle}>
                            <ConsumerTable consumerApplications={this.state.consumerApplications} />
                            <CommercialTable commercialApplications={this.state.commercialApplications} />
                        </div>
                    </div>
            );
        }
    });

    ReactDOM.render(<App />, document.getElementById('root') );
</script>
</body>
</html>